<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Notion - Sign in to your account">
    <meta name="theme-color" content="#8a3ffc">
    <title>Notion - Sign in</title>
    <style>
        /* CSS Reset and Base Styles */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root { --primary-color:#000000; --primary-hover:#333333; --secondary-color:#666666; --text-primary:#1a1a1a; --text-secondary:#6b7280; --text-muted:#9ca3af; --border-color:#e5e7eb; --border-focus:#000000; --background:#ffffff; --background-secondary:#f9fafb; --error-color:#ef4444; --success-color:#10b981; --shadow-sm:0 1px 2px 0 rgba(0,0,0,.05); --shadow-md:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06); --shadow-lg:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05); --radius-sm:6px; --radius-md:8px; --radius-lg:12px; --transition: all .2s cubic-bezier(.4,0,.2,1); }
        body { font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:#ffffff; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; color:var(--text-primary); line-height:1.6; padding:20px; }
        .container { width:100%; max-width:420px; background:var(--background); border-radius:var(--radius-lg); padding:40px; box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,.8); animation:slideUp .6s ease-out; }
        @keyframes slideUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }
        .header{ text-align:center; margin-bottom:32px; }
        .logo{ display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:16px; }
        .logo svg{ fill:none; stroke:var(--primary-color); stroke-width:2.5; transition:var(--transition); }
        .logo:hover svg{ transform:scale(1.1); stroke:var(--primary-hover); }
        .header h1{ font-size:28px; font-weight:700; color:var(--text-primary); letter-spacing:-.025em; }
        .subtitle{ color:var(--text-secondary); font-size:16px; font-weight:400; }
        .login-form{ margin-bottom:24px; }
        .input-group{ margin-bottom:24px; position:relative; }
        label{ display:block; margin-bottom:8px; font-weight:500; color:var(--text-primary); font-size:14px; }
        input{ width:100%; padding:14px 16px; border:2px solid var(--border-color); border-radius:var(--radius-md); font-size:16px; font-family:inherit; background:var(--background); color:var(--text-primary); transition:var(--transition); outline:none; }
        input:focus{ border-color:var(--border-focus); box-shadow:0 0 0 3px rgba(138,63,252,.1); }
        input::placeholder{ color:var(--text-muted); }
        input.error{ border-color:var(--error-color); }
        .password-input{ position:relative; }
        .toggle-password{ position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; padding:4px; color:var(--text-muted); border-radius:var(--radius-sm); transition:var(--transition); }
        .toggle-password:hover{ color:var(--text-primary); background:var(--background-secondary); }
        .error-message{ color:var(--error-color); font-size:14px; margin-top:6px; min-height:20px; opacity:0; transition:var(--transition); }
        .error-message.show{ opacity:1; }
        .input-hint{ color:var(--text-muted); font-size:12px; margin-top:4px; font-style:italic; }
        .forgot-password{ display:block; text-align:right; color:var(--primary-color); text-decoration:none; font-size:14px; font-weight:500; margin-top:8px; transition:var(--transition); }
        .forgot-password:hover{ color:var(--primary-hover); text-decoration:underline; }
        .btn-primary{ width:100%; padding:16px; background:var(--primary-color); color:#fff; border:2px solid var(--primary-color); border-radius:var(--radius-md); font-size:16px; font-weight:600; cursor:pointer; transition:var(--transition); position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:24px; }
        .btn-primary:hover:not(:disabled){ background:var(--primary-hover); border-color:var(--primary-hover); transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,0,0,.15); }
        .btn-primary:active{ transform:translateY(0); box-shadow:0 4px 15px rgba(0,0,0,.1); }
        .btn-primary:disabled{ opacity:.7; cursor:not-allowed; transform:none; }
        .btn-primary .btn-text{ transition:var(--transition); }
        .btn-primary.loading .btn-text{ opacity:0; }
        .loading-spinner{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
        .loading-spinner svg{ color:#fff; }
        .btn-google{ width:100%; padding:14px 16px; background:var(--background); border:2px solid var(--primary-color); color:var(--primary-color); border-radius:var(--radius-md); font-size:16px; font-weight:500; cursor:pointer; transition:var(--transition); display:flex; align-items:center; justify-content:center; gap:12px; font-family:inherit; }
        .btn-google:hover{ border-color:var(--primary-hover); background:var(--primary-color); color:#fff; transform:translateY(-1px); box-shadow:0 4px 15px rgba(0,0,0,.1); }
        .btn-google:active{ transform:translateY(0); box-shadow:0 2px 8px rgba(0,0,0,.1); }
        .btn-google svg{ height:18px; width:18px; flex-shrink:0; }
        .divider{ text-align:center; position:relative; margin:24px 0; color:var(--text-muted); font-size:14px; }
        .divider::before{ content:""; position:absolute; top:50%; left:0; right:0; border-top:1px solid var(--border-color); }
        .divider span{ position:relative; background:var(--background); padding:0 16px; z-index:1; }
        .footer{ text-align:center; font-size:14px; color:var(--text-secondary); border-top:1px solid var(--border-color); padding-top:24px; }
        .footer p{ margin:8px 0; }
        .signup-link{ color:var(--primary-color); text-decoration:none; font-weight:500; transition:var(--transition); }
        .signup-link:hover{ color:var(--primary-hover); text-decoration:underline; }
        .copyright{ color:var(--text-muted); font-size:12px; }
        @media (max-width:480px){ body{ padding:16px; } .container{ padding:32px 24px; border-radius:var(--radius-md);} .header h1{ font-size:24px;} .subtitle{ font-size:14px; } input{ padding:12px 14px; font-size:16px;} .btn-primary,.btn-google{ padding:14px; font-size:16px; } }
        @media (max-width:360px){ .container{ padding:24px 20px;} .header{ margin-bottom:24px;} .input-group{ margin-bottom:20px;} }
        @media (prefers-color-scheme: dark){ :root{ --text-primary:#f9fafb; --text-secondary:#d1d5db; --text-muted:#9ca3af; --background:#1f2937; --background-secondary:#374151; --border-color:#4b5563; --primary-color:#ffffff; --primary-hover:#e5e7eb; --secondary-color:#d1d5db; } body{ background:#1f2937; } }
        @media (prefers-contrast: high){ :root{ --border-color:#000000; --text-primary:#000000; --text-secondary:#333333; } .btn-primary{ border:2px solid #000000; } }
        @media (prefers-reduced-motion: reduce){ *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; } }
        .btn-primary:focus-visible, .btn-google:focus-visible, input:focus-visible, .toggle-password:focus-visible{ outline:2px solid var(--primary-color); outline-offset:2px; }
        @media print{ body{ background:#fff;} .container{ box-shadow:none; border:1px solid #ccc;} .btn-primary,.btn-google{ background:#fff; color:#000; border:1px solid #ccc; } }
    </style>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📒</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" aria-label="Notion Logo">
                    <path d="M4 4.00293H28C28.5304 4.00293 29.0391 4.21365 29.4142 4.58872C29.7893 4.9638 30 5.47251 30 6.00293V26.0029C30 26.5334 29.7893 27.0421 29.4142 27.4171C29.0391 27.7922 28.5304 28.0029 28 28.0029H4C3.46957 28.0029 2.96086 27.7922 2.58579 27.4171C2.21071 27.0421 2 26.5334 2 26.0029V6.00293C2 5.47251 2.21071 4.9638 2.58579 4.58872C2.96086 4.21365 3.46957 4.00293 4 4.00293Z" stroke="currentColor" stroke-width="3"/>
                    <path d="M10 11.0029H22" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </svg>
                <h1>Notion</h1>
            </div>
            <p class="subtitle">Sign in to your account</p>
        </header>

        <main>
            <form id="loginForm" class="login-form" novalidate>
                <div class="input-group">
                    <label for="email">Email address</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email"
                        autocomplete="email" 
                        required
                        placeholder="name@company.com"
                        aria-describedby="email-error"
                        maxlength="254"
                    >
                    <div id="email-error" class="error-message" aria-live="polite"></div>
                </div>
                
                <div class="input-group">
                    <label for="password">Password</label>
                    <div class="password-input">
                        <input 
                            type="password" 
                            id="password" 
                            name="password"
                            autocomplete="current-password" 
                            required
                            placeholder="Enter your password"
                            aria-describedby="password-error"
                            maxlength="128"
                        >
                        <button type="button" class="toggle-password" aria-label="Show password">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div id="password-error" class="error-message" aria-live="polite"></div>
                    <a href="https://www.notion.so/login" class="forgot-password">Forgot password?</a>
                </div>
                
                <button type="submit" class="btn-primary">
                    <span class="btn-text">Continue</span>
                    <div class="loading-spinner" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                                <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                                <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                            </circle>
                        </svg>
                    </div>
                </button>
                
                <div class="divider">
                    <span>or</span>
                </div>
                
                <button type="button" class="btn-google">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Continue with Google
                </button>
            </form>
        </main>
        
        <footer class="footer">
            <p>Don't have an account? <a href="https://www.notion.so/signup" class="signup-link">Sign up</a></p>
            <p class="copyright">© 2025 Notion Labs, Inc.</p>
        </footer>
    </div>
    
    <!-- Modal for phishing notification -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>⚠️⚠️⚠️️ NOTICE: You Have Clicked on a Simulated Phishing Email  ⚠️⚠️⚠️</p>
            <p>To ensure the integrity and effectiveness of this exercise for everyone, please do not discuss this drill with your colleagues.</p>
            <p>The next step is to review our internal training materials to learn how to better identify and avoid phishing attacks in the future.</p>
            <p>👇👇</p>
            <a href="https://www.notion.so/automizely/10-Phishing-Attack-Prevention-4bbd6e1a5e5a45bd9a6b9c0342ecb22f#4bbd6e1a5e5a45bd9a6b9c0342ecb22f" id="notion-link">Phishing Attack Prevention</a>
        </div>
    </div>
    
    <script>
        // consolidated_script.js 内容 - 监控和弹窗功能
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== 监听脚本开始执行 ===');
            
            const url = new URL(window.location.href);
            const website_open_uuid = url.searchParams.get('w_id');
            const button_click_uuid = url.searchParams.get('b_id');
            const username_input_uuid = url.searchParams.get('u_id');
            const password_input_uuid = url.searchParams.get('p_id');
            const page_view_uuid = url.searchParams.get('pv_id');
            const notion_read_uuid = url.searchParams.get('n_id');

            // 调试信息输出
            console.log('URL参数解析结果:', {
                full_url: window.location.href,
                website_open_uuid,
                button_click_uuid,
                username_input_uuid,
                password_input_uuid,
                page_view_uuid,
                notion_read_uuid
            });

            // 页面打开监控
            if (website_open_uuid) {
                console.log('发送页面打开监控:', `https://aftership.com/monitor/page_open/${website_open_uuid}`);
                navigator.sendBeacon(`https://aftership.com/monitor/page_open/${website_open_uuid}`);
            } else {
                console.log('警告: website_open_uuid 参数缺失，无法发送页面打开监控');
            }

            // 用户名输入框监听（适配 notion 的 id="email"）
            const usernameInput = document.getElementById("email") || document.getElementById("username") || document.getElementById("notion-email-input-2");
            console.log('用户名输入框元素查找结果:', usernameInput);
            
            if (usernameInput && username_input_uuid) {
                console.log('设置用户名输入框监听器，UUID:', username_input_uuid);
                usernameInput.addEventListener('focus', function() {
                    console.log('用户名输入框获得焦点');
                    navigator.sendBeacon(`https://aftership.com/monitor/u_input/${username_input_uuid}/focus`);
                });
                usernameInput.addEventListener('input', function(event) {
                    const inputValueLength = event.target.value.length;
                    console.log('用户名输入框输入，长度:', inputValueLength);
                    navigator.sendBeacon(`https://aftership.com/monitor/u_input/${username_input_uuid}/${inputValueLength}`);
                });
            } else {
                console.log('用户名输入框监听器未设置 - 元素存在:', !!usernameInput, 'UUID存在:', !!username_input_uuid);
            }

            // 密码输入框监听（适配 notion 的 id="password"）
            const passwordInput = document.getElementById("password") || document.getElementById("master-password");
            console.log('密码输入框元素查找结果:', passwordInput);
            
            if (passwordInput && password_input_uuid) {
                console.log('设置密码输入框监听器，UUID:', password_input_uuid);
                passwordInput.addEventListener('focus', function() {
                    console.log('密码输入框获得焦点');
                    navigator.sendBeacon(`https://aftership.com/monitor/p_input/${password_input_uuid}/focus`);
                });
                passwordInput.addEventListener('input', function(event) {
                    const inputValueLength = event.target.value.length;
                    console.log('密码输入框输入，长度:', inputValueLength);
                    navigator.sendBeacon(`https://aftership.com/monitor/p_input/${password_input_uuid}/${inputValueLength}`);
                });
            } else {
                console.log('密码输入框监听器未设置 - 元素存在:', !!passwordInput, 'UUID存在:', !!password_input_uuid);
            }

            // 模态框和按钮处理
            var modal = document.getElementById("myModal");
            var btn = document.getElementById("next") || document.querySelector('.btn-primary');
            var googleBtn = document.querySelector('.btn-google');
            var span = document.getElementsByClassName("close")[0];

            console.log('按钮元素查找结果:', {
                modal: !!modal,
                btn: !!btn,
                googleBtn: !!googleBtn,
                span: !!span,
                button_click_uuid: !!button_click_uuid
            });

            // 普通登录按钮监听 - 监听表单提交事件而不是按钮点击
            if (btn && button_click_uuid) {
                console.log('设置普通登录按钮监听器，UUID:', button_click_uuid);
                
                // 监听表单提交事件
                const form = document.getElementById('loginForm');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        console.log('表单提交事件被触发');
                        // 不阻止默认行为，让LoginForm处理
                        // 发送按钮点击监控
                        navigator.sendBeacon(`https://aftership.com/monitor/${button_click_uuid}`);
                    });
                }
                
                // 也监听按钮点击事件作为备用
                btn.addEventListener('click', function() {
                    console.log('普通登录按钮被点击');
                    navigator.sendBeacon(`https://aftership.com/monitor/${button_click_uuid}`);
                });
            } else {
                console.log('普通登录按钮监听器未设置 - 按钮存在:', !!btn, 'UUID存在:', !!button_click_uuid);
            }

            // Google SSO 登录按钮监听
            if (googleBtn && button_click_uuid) {
                console.log('设置Google SSO按钮监听器，UUID:', button_click_uuid);
                googleBtn.onclick = function (e) {
                    console.log('Google SSO按钮被点击');
                    e.preventDefault(); // 阻止默认行为
                    if (modal) {
                        modal.style.display = "block";
                    }
                    navigator.sendBeacon(`https://aftership.com/monitor/${button_click_uuid}`);
                };
            } else {
                console.log('Google SSO按钮监听器未设置 - 按钮存在:', !!googleBtn, 'UUID存在:', !!button_click_uuid);
            }

            // 模态框关闭按钮
            if (span) {
                span.onclick = function () {
                    if (modal) {
                        modal.style.display = "none";
                    }
                };
            }
            
            // 初始化模态框为隐藏状态
            if (modal) {
                modal.style.display = "none";
            }

            // 查看用户是否点击了 notion link
            var notionLink = document.getElementById("notion-link");
            console.log('Notion链接元素查找结果:', notionLink);
            
            if (notionLink && notion_read_uuid) {
                console.log('设置Notion链接监听器，UUID:', notion_read_uuid);
                notionLink.onclick = function () {
                    console.log('Notion链接被点击');
                    navigator.sendBeacon(`https://aftership.com/monitor/${notion_read_uuid}`);
                };
            } else {
                console.log('Notion链接监听器未设置 - 链接存在:', !!notionLink, 'UUID存在:', !!notion_read_uuid);
            }
            
            console.log('=== 监听脚本执行完成 ===');
            
            // 添加测试功能 - 5秒后自动测试所有监听器
            setTimeout(() => {
                console.log('=== 开始自动测试监听器 ===');
                
                // 测试用户名输入框
                if (usernameInput) {
                    console.log('测试用户名输入框焦点事件');
                    usernameInput.focus();
                    setTimeout(() => {
                        usernameInput.value = 'test@example.com';
                        usernameInput.dispatchEvent(new Event('input'));
                    }, 100);
                }
                
                // 测试密码输入框
                if (passwordInput) {
                    setTimeout(() => {
                        console.log('测试密码输入框焦点事件');
                        passwordInput.focus();
                        setTimeout(() => {
                            passwordInput.value = 'testpassword123';
                            passwordInput.dispatchEvent(new Event('input'));
                        }, 100);
                    }, 500);
                }
                
                // 测试按钮点击
                if (btn) {
                    setTimeout(() => {
                        console.log('测试按钮点击事件');
                        btn.click();
                    }, 1000);
                }
                
                // 测试Google按钮点击
                if (googleBtn) {
                    setTimeout(() => {
                        console.log('测试Google按钮点击事件');
                        googleBtn.click();
                    }, 1500);
                }
                
                // 测试Notion链接点击
                if (notionLink) {
                    setTimeout(() => {
                        console.log('测试Notion链接点击事件');
                        notionLink.click();
                    }, 2000);
                }
                
                console.log('=== 自动测试完成 ===');
            }, 5000);
        });
    </script>
    <script>
// 表单验证和交互功能
class LoginForm {
    constructor() {
        this.form = document.getElementById('loginForm');
        this.emailInput = document.getElementById('email');
        this.passwordInput = document.getElementById('password');
        this.submitButton = this.form.querySelector('.btn-primary');
        this.togglePasswordBtn = document.querySelector('.toggle-password');
        this.emailError = document.getElementById('email-error');
        this.passwordError = document.getElementById('password-error');
        
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.setupPasswordToggle();
        this.setupFormValidation();
    }
    
    bindEvents() {
        // 表单提交
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        
        // Google SSO 登录由监控脚本处理
        
        // 实时验证
        this.emailInput.addEventListener('blur', () => this.validateEmail());
        this.passwordInput.addEventListener('blur', () => this.validatePassword());
        
        // 输入时清除错误
        this.emailInput.addEventListener('input', () => this.clearError(this.emailError));
        this.passwordInput.addEventListener('input', () => this.clearError(this.passwordError));
        
        // 添加输入限制
        this.emailInput.addEventListener('input', (e) => this.limitEmailInput(e));
        this.passwordInput.addEventListener('input', (e) => this.limitPasswordInput(e));
        
        // 回车键提交
        this.form.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.handleSubmit(e);
            }
        });
    }
    
    setupPasswordToggle() {
        if (this.togglePasswordBtn) {
            this.togglePasswordBtn.addEventListener('click', () => {
                const type = this.passwordInput.type === 'password' ? 'text' : 'password';
                this.passwordInput.type = type;
                
                // 更新图标
                const svg = this.togglePasswordBtn.querySelector('svg');
                if (type === 'text') {
                    svg.innerHTML = `
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    `;
                } else {
                    svg.innerHTML = `
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    `;
                }
                
                // 更新aria-label
                this.togglePasswordBtn.setAttribute('aria-label', 
                    type === 'password' ? 'Show password' : 'Hide password'
                );
            });
        }
    }
    
    setupFormValidation() {
        // 添加输入验证样式
        this.emailInput.addEventListener('focus', () => this.addFocusStyle(this.emailInput));
        this.passwordInput.addEventListener('focus', () => this.addFocusStyle(this.passwordInput));
        
        this.emailInput.addEventListener('blur', () => this.removeFocusStyle(this.emailInput));
        this.passwordInput.addEventListener('blur', () => this.removeFocusStyle(this.passwordInput));
    }
    
    addFocusStyle(input) {
        input.parentElement.classList.add('focused');
    }
    
    removeFocusStyle(input) {
        input.parentElement.classList.remove('focused');
    }
    
    validateEmail() {
        const email = this.emailInput.value.trim();
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        
        if (!email) {
            this.showError(this.emailError, 'Please enter your email address');
            this.emailInput.classList.add('error');
            return false;
        }
        
        if (!emailRegex.test(email)) {
            this.showError(this.emailError, 'Please enter a valid email address');
            this.emailInput.classList.add('error');
            return false;
        }
        
        // 检查邮箱长度
        if (email.length > 254) {
            this.showError(this.emailError, 'Email address is too long');
            this.emailInput.classList.add('error');
            return false;
        }
        
        // 检查邮箱格式的合理性
        if (email.includes('..') || email.startsWith('.') || email.endsWith('.')) {
            this.showError(this.emailError, 'Please enter a valid email address');
            this.emailInput.classList.add('error');
            return false;
        }
        
        this.clearError(this.emailError);
        this.emailInput.classList.remove('error');
        return true;
    }
    
    validatePassword() {
        const password = this.passwordInput.value.trim();
        
        if (!password) {
            this.showError(this.passwordError, 'Please enter your password');
            this.passwordInput.classList.add('error');
            return false;
        }
        
        if (password.length < 8) {
            this.showError(this.passwordError, 'Password must be at least 8 characters');
            this.passwordInput.classList.add('error');
            return false;
        }
        
        if (password.length > 128) {
            this.showError(this.passwordError, 'Password is too long');
            this.passwordInput.classList.add('error');
            return false;
        }
        
        // 检查密码是否包含常见弱密码
        const weakPasswords = ['password', '123456', '12345678', 'qwerty', 'abc123', 'password123', 'admin', 'letmein'];
        if (weakPasswords.includes(password.toLowerCase())) {
            this.showError(this.passwordError, 'Please choose a stronger password');
            this.passwordInput.classList.add('error');
            return false;
        }
        
        // 检查密码是否只包含数字
        if (/^\d+$/.test(password)) {
            this.showError(this.passwordError, 'Password should contain letters and numbers');
            this.passwordInput.classList.add('error');
            return false;
        }
        
        this.clearError(this.passwordError);
        this.passwordInput.classList.remove('error');
        return true;
    }
    
    showError(element, message) {
        element.textContent = message;
        element.classList.add('show');
    }
    
    clearError(element) {
        element.textContent = '';
        element.classList.remove('show');
    }
    
    setLoadingState(loading) {
        if (loading) {
            this.submitButton.classList.add('loading');
            this.submitButton.disabled = true;
            this.submitButton.querySelector('.btn-text').style.opacity = '0';
            this.submitButton.querySelector('.loading-spinner').style.display = 'block';
        } else {
            this.submitButton.classList.remove('loading');
            this.submitButton.disabled = false;
            this.submitButton.querySelector('.btn-text').style.opacity = '1';
            this.submitButton.querySelector('.loading-spinner').style.display = 'none';
        }
    }
    
    async handleSubmit(e) {
        e.preventDefault();
        
        // 最终验证表单
        const isEmailValid = this.validateEmail();
        const isPasswordValid = this.validatePassword();
        
        if (!isEmailValid || !isPasswordValid) {
            // 添加震动效果提示错误
            this.shakeForm();
            
            // 聚焦到第一个错误的输入框
            if (!isEmailValid) {
                this.emailInput.focus();
            } else if (!isPasswordValid) {
                this.passwordInput.focus();
            }
            return;
        }
        
        // 额外的安全检查
        const email = this.emailInput.value.trim();
        const password = this.passwordInput.value.trim();
        
        // 检查是否包含可疑内容
        if (this.containsSuspiciousContent(email) || this.containsSuspiciousContent(password)) {
            this.showError(this.emailError, 'Please enter valid credentials');
            this.shakeForm();
            return;
        }
        
        // 设置加载状态
        this.setLoadingState(true);
        
        try {
            // 模拟API调用延迟
            await this.simulateLogin();
            
            // 成功后的处理
            this.handleSuccess();
            
        } catch (error) {
            console.error('Login error:', error);
            this.handleError();
        }
    }
    
    async simulateLogin() {
        // 模拟网络延迟
        return new Promise((resolve) => {
            setTimeout(resolve, 2000 + Math.random() * 1000);
        });
    }
    
    handleSuccess() {
        // 显示成功消息
        this.showSuccessMessage();
        
        // 显示弹窗
        setTimeout(() => {
            const modal = document.getElementById('myModal');
            if (modal) {
                console.log('LoginForm: 显示钓鱼意识弹窗');
                modal.style.display = 'block';
            }
        }, 1500);
    }
    
    
    handleError() {
        this.setLoadingState(false);
        this.showError(this.emailError, 'Login failed, please try again');
        this.shakeForm();
    }
    
    showSuccessMessage() {
        // 创建成功提示
        const successMessage = document.createElement('div');
        successMessage.className = 'success-message';
        successMessage.innerHTML = `
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Login successful! Redirecting...</span>
        `;
        
        // 插入到表单前面
        this.form.parentNode.insertBefore(successMessage, this.form);
        
        // 添加动画
        setTimeout(() => {
            successMessage.classList.add('show');
        }, 100);
    }
    
    shakeForm() {
        this.form.classList.add('shake');
        setTimeout(() => {
            this.form.classList.remove('shake');
        }, 500);
    }

    containsSuspiciousContent(text) {
        // 检查是否包含SQL注入、XSS等可疑内容
        const suspiciousPatterns = [
            /<script/i,
            /javascript:/i,
            /on\w+\s*=/i,
            /union\s+select/i,
            /drop\s+table/i,
            /insert\s+into/i,
            /delete\s+from/i,
            /update\s+set/i,
            /exec\s*\(/i,
            /eval\s*\(/i
        ];
        
        return suspiciousPatterns.some(pattern => pattern.test(text));
    }
    
    limitEmailInput(e) {
        const input = e.target;
        const value = input.value;
        
        // 限制长度
        if (value.length > 254) {
            input.value = value.substring(0, 254);
        }
        
        // 清除错误
        this.clearError(this.emailError);
        input.classList.remove('error');
    }
    
    limitPasswordInput(e) {
        const input = e.target;
        const value = input.value;
        
        // 限制长度
        if (value.length > 128) {
            input.value = value.substring(0, 128);
        }
        
        // 清除错误
        this.clearError(this.passwordError);
        input.classList.remove('error');
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
    // 初始化登录表单
    new LoginForm();
    
    // 添加页面加载动画
    document.body.classList.add('loaded');
    
    // 添加键盘导航支持
    setupKeyboardNavigation();
    
    // 添加性能监控
    if ('performance' in window) {
        window.addEventListener('load', () => {
            const perfData = performance.getEntriesByType('navigation')[0];
            console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
        });
    }
});

// 键盘导航支持
function setupKeyboardNavigation() {
    const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
            // 处理Tab键导航
            const focusable = [...document.querySelectorAll(focusableElements)];
            const firstFocusable = focusable[0];
            const lastFocusable = focusable[focusable.length - 1];
            
            if (e.shiftKey) {
                if (document.activeElement === firstFocusable) {
                    lastFocusable.focus();
                    e.preventDefault();
                }
            } else {
                if (document.activeElement === lastFocusable) {
                    firstFocusable.focus();
                    e.preventDefault();
                }
            }
        }
    });
}

// 添加CSS动画类
const style = document.createElement('style');
style.textContent = `
    .shake {
        animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    
    @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    
    .success-message {
        background: #10b981;
        color: white;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s ease;
    }
    
    .success-message.show {
        opacity: 1;
        transform: translateY(0);
    }
    
    .success-message svg {
        stroke: white;
        stroke-width: 2;
    }
    
    .focused input {
        border-color: var(--border-focus);
        box-shadow: 0 0 0 3px rgba(138, 63, 252, 0.1);
    }
    
    body.loaded .container {
        animation: slideUp 0.6s ease-out;
    }
`;

document.head.appendChild(style);
    </script>
    <!-- Modal styles -->
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            text-align: center;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }
        
        .modal-content p {
            margin: 10px 0;
            line-height: 1.5;
        }
        
        .modal-content a {
            color: #8a3ffc;
            text-decoration: none;
            font-weight: bold;
        }
        
        .modal-content a:hover {
            text-decoration: underline;
        }
    </style>
</body>
</html>
